generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Job {
  id        String   @id @default(cuid())
  queryText String
  status    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  resultId  String?
  trace     String?
  cacheKey  String?
  report    Report?
}

model Report {
  id         String   @id @default(cuid())
  jobId      String   @unique
  summary    String
  confidence Float
  pdfPath    String?
  data       String?
  createdAt  DateTime @default(now())
  job        Job      @relation(fields: [jobId], references: [id])
}

model Molecule {
  id               String   @id @default(cuid())
  name             String   @unique
  genericName      String?
  brandName        String?
  indication       String
  modality         String
  innovatorCompany String
  launchYear       Int?
  createdAt        DateTime @default(now())
}

model Patent {
  id                String    @id @default(cuid())
  molecule          String
  country           String
  patentNumber      String
  patentType        String
  isPrimary         Boolean   @default(false)
  status            String
  filingDate        DateTime?
  expiryDate        DateTime
  title             String?
  assignee          String?
  devicePatent      Boolean   @default(false)
  litigationHistory String?
  litigationRisk    String?
  dataQuality       String    @default("CURATED")
  confidenceLevel   String    @default("MEDIUM")
  dataSource        String?
  lastVerified      DateTime?
  reviewedBy        String?
  notes             String?
  createdAt         DateTime  @default(now())
}

model DiseaseMarket {
  id                      String    @id @default(cuid())
  disease                 String
  country                 String
  year                    Int
  prevalenceMillions      Float
  incidenceMillions       Float
  treatedRatePercent      Float
  avgAnnualTherapyCostUSD Float
  marketSizeUSD           Float?
  dataSource              String?
  dataQuality             String    @default("CURATED")
  confidenceLevel         String    @default("MEDIUM")
  confidenceBands         String?
  assumptions             String?
  lastVerified            DateTime?
  createdAt               DateTime  @default(now())

  @@unique([disease, country, year])
}

model ClinicalTrial {
  id              String    @id @default(cuid())
  molecule        String
  indication      String
  phase           String
  status          String    @default("Completed")
  country         String
  sponsor         String
  trialId         String?
  startDate       DateTime?
  completionDate  DateTime?
  primaryEndpoint String?
  outcome         String?
  citations       String
  outcomeVerified Boolean   @default(false)
  outcomeSource   String?
  outcomeNotes    String?
  dataQuality     String    @default("VERIFIED")
  confidenceLevel String    @default("HIGH")
  lastVerified    DateTime?
  createdAt       DateTime  @default(now())
}

model RegulatoryStatus {
  id               String    @id @default(cuid())
  molecule         String
  country          String
  status           String
  approvalDate     DateTime?
  approvalType     String?
  referenceProduct String?
  createdAt        DateTime  @default(now())

  @@unique([molecule, country])
}

model DrugPricing {
  id               String    @id @default(cuid())
  molecule         String
  country          String
  year             Int
  totalSpendingUSD Float?
  totalClaims      Int?
  costPerClaimUSD  Float?
  beneficiaries    Int?
  brandPriceUSD    Float?
  genericPriceUSD  Float?
  priceErosionPct  Float?
  mrpINR           Float?
  ceilingPriceINR  Float?
  dataSource       String
  dataConfidence   String    @default("MEDIUM")
  dataQuality      String    @default("CURATED")
  confidenceLevel  String    @default("MEDIUM")
  confidenceBands  String?
  assumptions      String?
  lastVerified     DateTime?
  createdAt        DateTime  @default(now())

  @@unique([molecule, country, year])
}

model GenericCompetition {
  id                        String    @id @default(cuid())
  molecule                  String
  country                   String
  year                      Int
  genericApprovals          Int
  biosimilarApprovals       Int       @default(0)
  activeManufacturers       Int
  topCompetitors            String?
  firstGenericDate          DateTime?
  brandMarketSharePct       Float?
  genericPenetrationPct     Float?
  avgGenericPriceVsBrandPct Float?
  competitionIntensity      String    @default("LOW")
  dataSource                String
  dataQuality               String    @default("CURATED")
  confidenceLevel           String    @default("MEDIUM")
  assumptions               String?
  lastVerified              DateTime?
  createdAt                 DateTime  @default(now())

  @@unique([molecule, country, year])
}

model MarketGrowth {
  id                 String   @id @default(cuid())
  disease            String
  country            String
  year               Int
  cagr5YearHistoric  Float?
  cagr5YearProjected Float?
  genericErosionRate Float?
  dataSource         String
  createdAt          DateTime @default(now())

  @@unique([disease, country, year])
}
